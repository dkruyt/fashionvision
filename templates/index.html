<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataVision</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Roboto', sans-serif;
        }
        .canvas-container {
            border: 2px solid #3399cc;
            display: inline-block;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .neuron {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 60px; /* Increased size */
            height: 60px; /* Increased size */
            border-radius: 30px; /* Adjusted for larger size */
            text-align: center;
            font-size: 12px;
            color: black; /* Changed for better visibility */
            background-size: cover; /* Ensure SVG covers the whole area */
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
            overflow: hidden; /* Ensures nothing spills out */
        }

        .neuron span {
            position: absolute;
            z-index: 2; /* Ensures text appears above the background image */
            color: black; /* Color of the text */
            font-weight: normal;
            background: rgba(255, 255, 255, 0.3); /* White with 50% opacity */
            padding: 1px 2px; /* Small padding around the text */
            border-radius: 2px; /* Rounded corners for the background */
            text-align: center;
            width: 100%; /* Ensures the background extends across the neuron */
        }
        .neuron:hover {
            transform: scale(1.3);
        }
        .neuron-container {
            display: inline-block;
            text-align: center;
            margin: -2px;
        }
        .neuron-number {
            margin-bottom: 5px;
            font-size: 14px;
            color: #343a40;
            font-weight: bold;
        }
        h1, h2 {
            color: #3399cc;
            margin-bottom: 20px;
        }
        .btn {
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #result {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
            margin-top: 20px;
        }
        #trainingData img {
            margin: 2px;
            cursor: pointer;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            transition: transform 0.2s;
        }
        #trainingData img:hover {
            transform: scale(1.1);
        }
        #logWindow {
            height: 200px;
            overflow-y: scroll;
            border: 1px solid #dee2e6;
            padding: 10px;
            background-color: #ffffff;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #3399cc;
            color: white;
            border-radius: 15px 15px 0 0 !important;
        }
        .hidden {
        display: none;
        }
        .data-hidden {
            display: none !important;
        }
        .small-input {
        width: 80px;
        display: inline-block;
        }
        .validation-image-container {
        display: inline-block;
        margin: 1px;
        text-align: center;
        }
        .validation-image {
        border: 2px solid;
        margin-bottom: 1px;
        }
        .validation-info {
        font-size: 10px;
        }
        #confusionMatrixContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 850px; /* Slightly larger than the plot to account for any margins */
            width: 100%;
        }
        #trainingProgressContainer {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .progress {
            height: 25px;
        }

        .progress-bar {
            background-color: #3399cc;
        }
        #weightHeatmapPopup {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-5"><i class="fas fa-image"></i> DataVision</h1>
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="mb-0">Neural Network Visualization</h2>
                    </div>
                    <div class="card-body text-center">
                        <h3>Input Layer</h3>
                        <div class="canvas-container mx-auto">
                            <canvas id="inputCanvas" width="280" height="280"></canvas>
                        </div>
                        <h3 class="mt-3"><i class="fas fa-arrow-down"></i></h3>
                        <div class="canvas-container mx-auto">
                            <canvas id="extendedLineCanvas" width="560" height="10"></canvas>
                        </div>
                        <h3 class="mt-3"><i class="fas fa-arrow-down"></i>Hidden Layer <i class="fas fa-arrow-down"></i></h3>
                        <div id="hiddenLayer" class="neuron-container mx-auto"></div>
                        <h3 class="mt-3"><i class="fas fa-arrow-down"></i>Output Layer <i class="fas fa-arrow-down"></i></h3>
                        <div id="outputLayer" class="neuron-container mx-auto"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="mb-0">Dashboard</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <button id="predictButton" class="btn btn-primary"><i class="fas fa-magic"></i> Predict</button>
                            <input type="number" id="hiddenNeuronsInput" class="form-control small-input" value="24" min="1">
                            <button id="updateHiddenNeuronsButton" class="btn btn-primary">Update Hidden Neurons</button>
                            <button id="clearButton" class="btn btn-secondary"><i class="fas fa-eraser"></i> Clear</button>
                            <button id="dataButton" class="btn btn-info"><i class="fas fa-database"></i> Load Data</button>
                            <button id="switchModelButton" class="btn btn-primary"><i class="fas fa-exchange-alt"></i> Switch to Advanced Model</button>
                            <button id="switchDatasetButton" class="btn btn-primary"><i class="fas fa-exchange-alt"></i> Switch to QMNIST</button>
                            <button id="train1Button" class="btn btn-success"><i class="fas fa-graduation-cap"></i> Train 1x</button>
                            <button id="train10Button" class="btn btn-success"><i class="fas fa-graduation-cap"></i> Train 10x</button>
                            <button id="train100Button" class="btn btn-success"><i class="fas fa-graduation-cap"></i> Train 100x</button>
                            <button id="clearModelButton" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear network</button>
                            <button id="helpButton" class="btn btn-info"><i class="fas fa-question-circle"></i> Help</button>
                            <button id="graphsButton" class="btn btn-info"><i class="fas fa-chart-line"></i> Graphs</button>
                            <button id="distributionsButton" class="btn btn-info"><i class="fas fa-chart-bar"></i> Distributions</button>
                            <button id="networkVisualizationButton" class="btn btn-info"><i class="fas fa-project-diagram"></i> Network Visualization</button>
                            <button id="showConfusionMatrixButton" class="btn btn-info"><i class="fas fa-table"></i> Confusion Matrix</button>
                            <button id="uploadButton" class="btn btn-primary"><i class="fas fa-upload"></i> Upload Image</button>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                        </div>
                        <div id="result" class="mt-3"></div>
                        <div id="trainingProgressContainer" class="mt-3" style="display: none;">
                            <h5>Training Progress</h5>
                            <div class="progress">
                                <div id="trainingProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                            </div>
                            <p id="trainingProgressText" class="mt-2"></p>
                        </div>
                        <div id="logWindow" class="mt-3"></div>
                        <div id="trainingDataSection">
                            <h3 class="mt-4">Training Data</h3>
                            <div id="trainingData" class="d-flex flex-wrap"></div>
                        </div>
                        <div id="validationDataSection">
                            <h3 class="mt-4">Validation Data</h3>
                            <div id="validationData" class="d-flex flex-wrap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Visualization Modal -->
    <div class="modal fade" id="networkVisualizationModal" tabindex="-1" aria-labelledby="networkVisualizationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="networkVisualizationModalLabel">Neural Network Visualization</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-4">
                        This visualization represents the structure and current state of the neural network. 
                        It shows how information flows from the input layer through the hidden layer(s) to the output layer.
                    </p>
                    <ul>
                        <li><strong>Nodes (circles)</strong> represent individual neurons in each layer</li>
                        <li><strong>Lines</strong> represent connections (weights) between neurons</li>
                        <li><strong>Colors</strong> indicate the strength and direction of connections:
                            <ul>
                                <li>Red lines represent positive weights</li>
                                <li>Blue lines represent negative weights</li>
                                <li>Brighter colors indicate stronger connections</li>
                            </ul>
                        </li>
                        <li><strong>Node colors</strong> represent the activation level of each neuron:
                            <ul>
                                <li>Brighter colors indicate higher activation</li>
                                <li>Darker colors indicate lower activation</li>
                            </ul>
                        </li>
                    </ul>
                    <p>
                        This visualization helps you understand how the network processes information and makes decisions. 
                        Look for patterns in the connections and activations to gain insights into what features the network finds important.
                    </p>
                    <canvas id="networkVisualizationCanvas"></canvas>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confusion Matrix Modal -->
    <div class="modal fade" id="confusionMatrixModal" tabindex="-1" aria-labelledby="confusionMatrixModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confusionMatrixModalLabel">Confusion Matrix</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-4">
                        A confusion matrix is a table that visualizes the performance of a classification model. 
                        It shows the number of correct and incorrect predictions made by the model compared to the actual outcomes.
                    </p>
                    <ul>
                        <li><strong>Rows</strong> represent the actual classes</li>
                        <li><strong>Columns</strong> represent the predicted classes</li>
                        <li>The <strong>diagonal elements</strong> represent the number of correct predictions for each class</li>
                        <li>The <strong>off-diagonal elements</strong> represent the misclassifications</li>
                    </ul>
                    <p>
                        A perfect model would have high numbers along the diagonal and zeros elsewhere. 
                        Look for patterns in misclassifications to understand where the model might be struggling.
                    </p>
                    <div class="d-flex justify-content-center align-items-center">
                        <div id="confusionMatrixContainer"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Distributions Modal -->
    <div class="modal fade" id="distributionsModal" tabindex="-1" aria-labelledby="distributionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="distributionsModalLabel">Distributions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-4">These graphs show the distributions of weights, biases, and activations in the neural network, as well as the prediction confidence for the current input.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Weight Distribution</h3>
                            <p>This histogram shows the distribution of weights in the neural network. A balanced distribution around zero is generally desirable.</p>
                            <img id="weightHistogram" class="img-fluid">
                        </div>
                        <div class="col-md-6">
                            <h3>Bias Distribution</h3>
                            <p>This histogram shows the distribution of biases in the neural network. Biases help shift the activation function and can be crucial for learning.</p>
                            <img id="biasHistogram" class="img-fluid">
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h3>Activation Distribution</h3>
                            <p>This histogram shows the distribution of neuron activations for the current input. It helps understand which neurons are active and to what degree.</p>
                            <img id="activationHistogram" class="img-fluid">
                        </div>
                        <div class="col-md-6">
                            <h3>Prediction Confidence</h3>
                            <p>This bar chart shows the network's confidence in each possible class for the current input. Higher bars indicate greater confidence.</p>
                            <canvas id="confidenceChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4>Welcome to DataVision!</h4>
                    <p>DataVision is an interactive web application that allows you to explore and understand how a neural network recognizes images. Follow the steps below to get started:</p>
                    <ol>
                        <li>
                            <strong>Load Training Data:</strong> Click the "Load Data" button to load the training data. This data consists of a collection of images that will be used to train the neural network. The loaded training images will be displayed in the "Training Data" section.
                        </li>
                        <li>
                            <strong>Explore the Neural Network:</strong> Take a moment to familiarize yourself with the neural network architecture displayed on the left side of the screen. The input layer represents a 28x28 grid where you can draw or upload an image, the hidden layer consists of neurons that learn to recognize patterns, and the output layer represents the predicted class.
                        </li>
                        <li>
                            <strong>Draw or Upload an Image:</strong> Use your mouse to draw on the input layer grid or click the "Upload Image" button to use an existing image. The goal is to provide an image that the neural network can classify.
                        </li>
                        <li>
                            <strong>Make a Prediction:</strong> Once you've drawn or uploaded an image, click the "Predict" button to see what the neural network thinks the image represents. The predicted class will be displayed in the "Dashboard" section.
                        </li>
                        <li>
                            <strong>Train the Neural Network:</strong> To improve the neural network's accuracy, you can train it using the loaded training data. Click the "Train 1x," "Train 10x," or "Train 100x" buttons to train the network for the specified number of epochs. During training, the app will display the training progress and metrics in the log window.
                        </li>
                        <li>
                            <strong>Evaluate the Neural Network:</strong> After training, you can provide more images and click "Predict" to see how well the neural network performs. The app will display the predicted class and the activations of the hidden and output layers.
                        </li>
                        <li>
                            <strong>Explore Further:</strong>
                            <ul>
                                <li>Click on the neurons in the output layer to see how the neural network responds when you manually assign a label to your input image. This can help you understand how the network learns from individual examples.</li>
                                <li>Use the "Clear" button to clear the input layer grid and start with a new image.</li>
                                <li>Click the "Clear Model Data" button to reset the neural network to its initial state, clearing all learned weights.</li>
                                <li>Explore the "Graphs" section to visualize the training and validation metrics, including loss and accuracy over epochs.</li>
                                <li>Check the "Distributions" to see histograms of weights, biases, and activations, as well as the prediction confidence for the current input.</li>
                                <li>View the "Confusion Matrix" to understand how well the model is performing across different classes.</li>
                                <li>Use the "Switch to Advanced Model" button to toggle between a simple and more complex neural network architecture.</li>
                                <li>Use the "Switch to QMNIST" button to change between different datasets (Fashion-MNIST and QMNIST).</li>
                            </ul>
                        </li>
                    </ol>
                    <p>Have fun exploring and learning about neural networks and image recognition with DataVision!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphs Modal -->
    <div class="modal fade" id="graphsModal" tabindex="-1" aria-labelledby="graphsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="graphsModalLabel">Training and Validation Metrics</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-4">These graphs show the performance of the neural network during training. They help visualize how well the model is learning and if it's overfitting or underfitting.</p>
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Loss</h3>
                            <p>This graph shows how the loss (error) decreases over time for both training and validation data. Lower loss indicates better performance.</p>
                            <canvas id="lossChart"></canvas>
                        </div>
                        <div class="col-md-6">
                            <h3>Accuracy</h3>
                            <p>This graph shows how the accuracy improves over time for both training and validation data. Higher accuracy indicates better performance.</p>
                            <canvas id="accuracyChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <div id="weightHeatmapPopup" style="position: absolute; display: none; z-index: 1000;"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="/static/index.js"></script>
</body>
</html>